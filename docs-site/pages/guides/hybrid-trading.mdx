---
title: Hybrid Trading System
description: AMM + Orderbook trading system guide
---

# Hybrid AMM + Orderbook Trading System

## Overview

The Pariflow platform features a sophisticated hybrid trading system that combines the benefits of Automated Market Making (AMM) with traditional order book functionality. This system provides both liquidity providers and traders with optimal trading experiences.

## Key Features

### Hybrid Trading Engine
- **AMM Liquidity**: Automated Market Maker provides instant liquidity at transparent prices
- **Order Book**: Traditional limit order matching for price discovery
- **Smart Routing**: Automatically matches orders against both AMM and other traders
- **Real-time Updates**: WebSocket-powered live price and order book updates

### Liquidity Provider
- **Constant Liquidity**: Provides deep liquidity per market
- **Dynamic Pricing**: Uses LMSR (Logarithmic Market Scoring Rule) for fair pricing
- **Spread Trading**: Maintains tight spreads around fair market price
- **Automatic Rebalancing**: Continuously updates prices based on market activity

### Order Book Features
- **Limit Orders**: Set specific prices for buying/selling
- **Market Orders**: Execute immediately at best available price
- **Order Matching**: Advanced matching engine with price-time priority
- **Real-time Updates**: Live order book updates via WebSocket

## How It Works

### Order Flow

1. **User Places Order**
   - Select market/limit order type
   - Choose side (buy/sell) and outcome (YES/NO)
   - Set amount and (optionally) limit price

2. **Smart Order Matching**
   - **Limit Orders**: First match against existing orders in order book
   - **Market Orders**: Execute immediately against best available liquidity
   - **Unfilled Amounts**: Route remaining to AMM for instant execution

3. **AMM Integration**
   - Uses LMSR formula for fair pricing
   - Automatically adjusts odds based on trading activity
   - Provides liquidity for immediate execution

4. **Real-time Updates**
   - WebSocket broadcasts trade updates
   - Order book refreshes automatically
   - Price feeds update in real-time

### Liquidity Provider Operation

The liquidity provider continuously:
1. **Monitors Market Activity**: Tracks trades and price changes
2. **Updates Prices**: Recalculates fair value using LMSR
3. **Maintains Liquidity**: Ensures traders can always execute
4. **Manages Risk**: Balances positions across outcomes

## API Usage

### Place Order

```javascript
// Market Order
POST /api/hybrid-trading
{
  "eventId": "example-market-id",
  "side": "buy",
  "option": "YES", 
  "amount": 100,
  "orderType": "market"
}

// Limit Order
POST /api/hybrid-trading
{
  "eventId": "example-market-id",
  "side": "buy",
  "option": "YES",
  "amount": 100,
  "price": 0.65,
  "orderType": "limit"
}
```

### Get Order Book

```javascript
GET /api/hybrid-trading?eventId=example-market-id&option=YES

// Response
{
  "bids": [
    {"price": 0.64, "amount": 500},
    {"price": 0.63, "amount": 300}
  ],
  "asks": [
    {"price": 0.66, "amount": 200},
    {"price": 0.67, "amount": 400}
  ]
}
```

## Frontend Integration

### WebSocket Subscription

```javascript
// Subscribe to event updates
socket.emit('join-event', eventId);

// Subscribe to order book
socket.emit('subscribe-orderbook', { eventId, option: 'YES' });

// Listen for updates
socket.on('trade-update', (data) => {
  // Handle trade updates
});

socket.on('orderbook-update', (data) => {
  // Handle order book updates
});
```

### Trading Panel

The TradingPanel component includes:
- Order type selection (Market/Limit)
- Real-time order book display
- Price inputs for limit orders
- WebSocket-powered updates
- Comprehensive trade feedback

## Benefits

### For Traders
- **Instant Execution**: Market orders execute immediately
- **Price Control**: Limit orders allow precise price setting
- **Best Prices**: System automatically finds optimal execution
- **Transparency**: Real-time order book and price feeds

### For Liquidity Providers
- **Passive Income**: Earn from spreads
- **Risk Management**: Automated position sizing
- **Fair Pricing**: LMSR ensures mathematically fair prices
- **Market Making**: Continuous liquidity provision

### For the Platform
- **Reduced Slippage**: Multiple liquidity sources
- **Better UX**: Choice between speed and price control
- **Real-time Data**: Live updates enhance trading experience
- **Scalable Architecture**: Handles high-frequency trading

## Technical Details

### LMSR Formula

The Logarithmic Market Scoring Rule (LMSR) provides mathematically sound pricing:

```
Price = 1 / (1 + e^((q_no - q_yes) / b))
```

Where:
- `q_yes` = Quantity of YES outcome tokens
- `q_no` = Quantity of NO outcome tokens  
- `b` = Liquidity parameter (controls price sensitivity)

### Order Matching Priority
1. **Price Priority**: Best prices first
2. **Time Priority**: Earlier orders first
3. **AMM Fallback**: Unfilled amounts execute against liquidity pool

### WebSocket Events
- `trade-update`: New trade execution
- `orderbook-update`: Order book changes
- `odds-update`: Price changes
- `portfolio-update`: User balance changes

## Getting Started

1. **Start Development Server**:
   ```bash
   npm run dev
   ```

2. **Access Application**:
   Navigate to any event page

3. **Test Trading**:
   - Use the TradingPanel to place orders
   - Watch real-time updates

## Future Enhancements

- **Advanced Order Types**: Stop-loss, conditional orders
- **Portfolio Management**: PnL tracking, position sizing
- **Risk Management**: Position limits
- **API Trading**: RESTful and WebSocket APIs for automated trading
- **Cross-market Strategies**: Multi-event trading

---

This hybrid system provides the best of both worlds: the immediacy of AMM trading and the precision of order book trading, creating a professional-grade prediction market platform.
